name: Sign Android App

on:
  push:
    branches:
      - dev

env:
  KEYSTORE_PASSWORD: ${{ secrets.KEYSTORE_PASSWORD }}
  KEY_PASSWORD: ${{ secrets.KEY_PASSWORD }}

jobs:
  sign:
    runs-on: ubuntu-latest

steps:
  - name: Checkout code
    uses: actions/checkout@v2

  - name: Set up Java
    uses: actions/setup-java@v1
    with:
      java-version: 11

  - name: Set up Android SDK
    uses: actions/setup-android@v2
    with:
      android-sdk-tools: 29.0.3

  - name: Decode keystore file
    id: decode-keystore-file
    run: echo ${{ secrets.KEYSTORE_FILE }} | base64 --decode > ${{ env.HOME }}/key.jks

  - name: Sign app
    run: ./gradlew signApk --stacktrace
    env:
      KEY_STORE_FILE: ${{ env.HOME }}/key.jks
      KEY_STORE_PASSWORD: ${{ env.KEYSTORE_PASSWORD }}
      KEY_PASSWORD: ${{ env.KEY_PASSWORD }}
